<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Publications • Stanfield Lab</title>
  <meta name="description" content="Stanfield Lab at LSU SVM: Viral oncology and guinea-pig models of virus-associated cancers.">
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

<header class="site-header" role="banner">
  <div class="container header-wrap">
    <a class="brand" href="index.html" aria-label="Stanfield Lab home">
      <img src="assets/stanfield-lab-logo.svg" alt="Stanfield Lab" class="brand-img">
    </a>
    <nav aria-label="Primary">
      <button id="navToggle" class="nav-toggle" aria-expanded="false" aria-controls="primaryNav">Menu</button>
      <ul id="primaryNav" class="nav-list">
        <li><a href="index.html">Home</a></li>
        <li><a href="research.html">Research</a></li>
        <li><a href="people.html">People</a></li>
        <li><a href="publications.html" aria-current="page">Publications</a></li>
        <li><a href="news.html">News</a></li>
        <li><a href="opportunities.html">Opportunities</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
    </nav>
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">◐</button>
  </div>
</header>

<main id="main" class="container">
  <h1>Publications</h1>

  <div class="pub-toolbar">
    <input id="pubSearch" type="search" placeholder="Search by title, author, year…" aria-label="Search publications">
    <select id="pubYearFilter" aria-label="Filter by year"></select>
  </div>
  <ol id="pubList" class="pub-list" aria-live="polite"></ol>

  <script>
    // Publications loader (robust to different JSON shapes)
    async function loadPublications() {
      const pubList = document.getElementById('pubList');
      const pubYearFilter = document.getElementById('pubYearFilter');
      const pubSearch = document.getElementById('pubSearch');
      let publications = [];

      try {
        const res = await fetch('assets/publications.json', { cache: 'no-store' });
        const data = await res.json();

        // Accept either an array or { publications: [...] }
        const raw = Array.isArray(data) ? data
                  : (Array.isArray(data.publications) ? data.publications : []);

        // Normalize fields and coerce types
        publications = raw.map(p => ({
          title: p.title || '',
          authors: p.authors || p.author || '',
          journal: p.journal || '',
          year: p.year ? Number(p.year) : undefined,
          link: p.link || ''
        }));

        // Sort by year desc, then title
        publications.sort((a, b) => (b.year || 0) - (a.year || 0) || a.title.localeCompare(b.title));
      } catch (e) {
        pubList.innerHTML = '<li class="error">Could not load publications.</li>';
        return;
      }

      function formatPub(pub) {
        return `
          <li>
            <span class="pub-title">${pub.title}</span><br>
            <span class="pub-authors">${pub.authors}</span>
            <span class="pub-journal">${pub.journal ? ' • ' + pub.journal : ''}</span>
            <span class="pub-year">${pub.year ? ' • ' + pub.year : ''}</span>
            ${pub.link ? `<a href="${pub.link}" target="_blank" rel="noopener">[Link]</a>` : ''}
          </li>
        `;
      }

      function renderList(list) {
        pubList.innerHTML = list.length
          ? list.map(formatPub).join('')
          : '<li class="muted">No publications match your filters.</li>';
      }

      // Year filter options
      const years = Array.from(new Set(publications.map(p => p.year).filter(Boolean))).sort((a,b)=>b-a);
      pubYearFilter.innerHTML = `<option value="">All years</option>` + years.map(y => `<option value="${y}">${y}</option>`).join('');

      function filterAndRender() {
        const search = pubSearch.value.trim().toLowerCase();
        const year = pubYearFilter.value;
        let filtered = publications;

        if (year) filtered = filtered.filter(p => String(p.year) === year);
        if (search) {
          filtered = filtered.filter(p =>
            (p.title && p.title.toLowerCase().includes(search)) ||
            (p.authors && p.authors.toLowerCase().includes(search)) ||
            (p.journal && p.journal.toLowerCase().includes(search)) ||
            (p.year && String(p.year).includes(search))
          );
        }
        renderList(filtered);
      }

      pubSearch.addEventListener('input', filterAndRender);
      pubYearFilter.addEventListener('change', filterAndRender);

      // Initial render
      renderList(publications);
    }

    document.addEventListener('DOMContentLoaded', loadPublications);
  </script>
</main>

<footer class="site-footer" role="contentinfo">
  <div class="container footer-grid">
    <div class="footer-brand">
      <img src="assets/stanfield-lab-icon.svg" alt="Stanfield Lab icon" class="footer-logo">
      <div>
        <h3>Stanfield Lab</h3>
        <p>Viral Oncology • Small-Animal Models • Translational Immunology</p>
      </div>
    </div>
    <div>
      <h4>Find us</h4>
      <p>
        <a href="https://www.lsu.edu/vetmed/index.php" target="_blank" rel="noopener">LSU School of Veterinary Medicine</a><br>
        Baton Rouge, LA 70803
      </p>
    </div>
    <div>
      <h4>Contact</h4>
      <p><a href="mailto:bstanf5@lsu.edu">bstanf5@lsu.edu</a></p>
    </div>
  </div>
  <div class="container footer-bottom">
    <p>© <span id="year"></span> Stanfield Lab • LSU SVM</p>
  </div>
  <script src="assets/script.js"></script>
</footer>

</body>
</html>
