<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>People • Stanfield Lab</title>
  <meta name="description" content="Stanfield Lab at LSU SVM: Viral oncology and guinea-pig models of virus-associated cancers.">
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    /* Uniform portrait sizing */
    .person-photo {
      width: 160px;
      height: 160px;
      object-fit: cover;     /* crop to fill, no distortion */
      border-radius: 50%;    /* circle avatars */
      display: block;
      margin: 0 auto 1rem;   /* center in card */
    }
    /* Optional: tighten person cards a bit */
    .cards-people {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1rem;
    }
    .card.person {
      padding: 1rem;
      border: 1px solid var(--border, #e5e7eb);
      border-radius: 12px;
      background: var(--card, #fff);
    }
    .person-body { text-align: center; }
    .person-name { margin: 0 0 .25rem; }
    .person-role { margin: 0 0 .25rem; font-size: .95rem; opacity: .9; }
    .person-email, .person-links { margin: 0; font-size: .9rem; }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="site-header" role="banner">
    <div class="container header-wrap">
      <a class="brand" href="index.html" aria-label="Stanfield Lab home">
        <img src="assets/stanfield-lab-logo.svg" alt="Stanfield Lab" class="brand-img">
      </a>
      <nav aria-label="Primary">
        <button id="navToggle" class="nav-toggle" aria-expanded="false" aria-controls="primaryNav">Menu</button>
        <ul id="primaryNav" class="nav-list">
          <li><a href="index.html">Home</a></li>
          <li><a href="research.html">Research</a></li>
          <li><a href="people.html" aria-current="page">People</a></li>
          <li><a href="publications.html">Publications</a></li>
          <li><a href="news.html">News</a></li>
          <li><a href="opportunities.html">Opportunities</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>
      <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode">◐</button>
    </div>
  </header>

  <main id="main" class="container">
    <h1>People</h1>

    <div class="pub-toolbar" style="margin-bottom:1rem;">
      <input id="peopleSearch" type="search" placeholder="Search by name or role…" aria-label="Search people">
      <select id="roleFilter" aria-label="Filter by role"></select>
    </div>

    <div id="peopleGrid" class="cards-people" aria-live="polite"></div>

    <script>
      async function loadPeople() {
        const grid = document.getElementById('peopleGrid');
        const searchInput = document.getElementById('peopleSearch');
        const roleFilter = document.getElementById('roleFilter');
        let people = [];

        function showError(msg) {
          grid.innerHTML = `<p class="error" style="color:crimson;">${msg}</p>`;
        }

        try {
          const res = await fetch('assets/people.json?v=' + Date.now(), { cache: 'no-store' });
          if (!res.ok) throw new Error(`HTTP ${res.status} loading people.json`);
          const text = await res.text();

          if (text.trim().startsWith('<')) {
            throw new Error('Expected JSON but received HTML (check path or 404).');
          }

          const data = JSON.parse(text);
          const raw = Array.isArray(data) ? data
                    : (Array.isArray(data.people) ? data.people : null);
          if (!raw) throw new Error('people.json must be an array or { "people": [...] }.');

          people = raw.map((p, i) => {
            if (!p || typeof p !== 'object') {
              console.warn('Bad entry at index', i, p);
              return { name: '', role: '', email: '' };
            }
            return {
              name: p.name || '',
              role: p.role || '',
              email: p.email || '',
              photo: p.photo || '',
              website: p.website || '',
              scholar: p.scholar || '',
              github: p.github || '',
              twitter: p.twitter || '',
              linkedin: p.linkedin || ''
            };
          });

          const bad = people.findIndex(p => !p.name);
          if (bad !== -1) console.warn('Entry missing "name" at index', bad, raw[bad]);

          const isPI = r => /prof|pi|director/i.test(r);
          people.sort((a, b) => {
            const aPI = isPI(a.role), bPI = isPI(b.role);
            if (aPI !== bPI) return aPI ? -1 : 1;
            const roleCmp = (a.role || '').localeCompare(b.role || '');
            return roleCmp !== 0 ? roleCmp : (a.name || '').localeCompare(b.name || '');
          });

        } catch (err) {
          console.error(err);
          showError('Could not load people: ' + err.message);
          return;
        }

        const roles = Array.from(new Set(people.map(p => p.role).filter(Boolean))).sort((a,b)=>a.localeCompare(b));
        roleFilter.innerHTML = '<option value="">All roles</option>' + roles.map(r => `<option value="${r}">${r}</option>`).join('');

        function linkIcon(href, label) {
          if (!href) return '';
          const safe = String(href);
          return `<a href="${safe}" target="_blank" rel="noopener" aria-label="${label}">${label}</a>`;
        }

        function formatCard(p) {
          const photo = p.photo ? `<img class="person-photo" src="${p.photo}" alt="Photo of ${p.name}">` : '';
          const links = [
            p.website && linkIcon(p.website, 'Website'),
            p.scholar && linkIcon(p.scholar, 'Scholar'),
            p.github && linkIcon(p.github, 'GitHub'),
            p.twitter && linkIcon(p.twitter, 'Twitter'),
            p.linkedin && linkIcon(p.linkedin, 'LinkedIn')
          ].filter(Boolean).join(' • ');

          return `
            <article class="card person">
              ${photo}
              <div class="person-body">
                <h3 class="person-name">${p.name}</h3>
                <p class="person-role">${p.role}</p>
                ${p.email ? `<p class="person-email"><a href="mailto:${p.email}">${p.email}</a></p>` : ''}
                ${links ? `<p class="person-links">${links}</p>` : ''}
              </div>
            </article>
          `;
        }

        function render(list) {
          grid.innerHTML = list.length
            ? list.map(formatCard).join('')
            : '<p class="muted">No people match your filters.</p>';
        }

        function filterAndRender() {
          const q = searchInput.value.trim().toLowerCase();
          const role = roleFilter.value;
          let filtered = people;
          if (role) filtered = filtered.filter(p => p.role === role);
          if (q) {
            filtered = filtered.filter(p =>
              (p.name && p.name.toLowerCase().includes(q)) ||
              (p.role && p.role.toLowerCase().includes(q)) ||
              (p.email && p.email.toLowerCase().includes(q))
            );
          }
          render(filtered);
        }

        searchInput.addEventListener('input', filterAndRender);
        roleFilter.addEventListener('change', filterAndRender);

        render(people);
      }

      document.addEventListener('DOMContentLoaded', loadPeople);
    </script>
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="container footer-grid">
      <div class="footer-brand">
        <img src="assets/stanfield-lab-icon.svg" alt="Stanfield Lab icon" class="footer-logo">
        <div>
          <h3>Stanfield Lab</h3>
          <p>Viral Oncology • Small-Animal Models • Translational Immunology</p>
        </div>
      </div>
      <div>
        <h4>Find us</h4>
        <p>
          <a href="https://www.lsu.edu/vetmed/index.php" target="_blank" rel="noopener">LSU School of Veterinary Medicine</a><br>
          Baton Rouge, LA 70803
        </p>
      </div>
      <div>
        <h4>Contact</h4>
        <p><a href="mailto:bstanf5@lsu.edu">bstanf5@lsu.edu</a></p>
      </div>
    </div>
    <div class="container footer-bottom">
      <p>© <span id="year"></span> Stanfield Lab • LSU SVM</p>
    </div>
    <script src="assets/script.js"></script>
  </footer>

</body>
</html>
